function init(){var whichCitySelection=$("citySelection");if(whichCitySelection){whichCitySelection.onblur=function(){if(whichCitySelection.value==""){if(inputCityValueCache!=""){$("citySelection").value=inputCityValueCache}}};whichCitySelection.onclick=function(){inputCityValueCache=$("citySelection").value;$("citySelection").value="";if($("lat")&&$("lon")){$("lat").value="";$("lon").value=""}}}var whichCountry=$("countrySelect");if(whichCountry){whichCountry.onchange=function(){if($("lat")&&$("lon")){$("lat").value="";$("lon").value="";if($("citySelection")){$("citySelection").value=""}markersArray=null;xml=null;isXmlLoad=false}if($("tracksForm")){$("tracksForm").submit()}}}var whichLanguage=$("languageSelect");if(whichLanguage){whichLanguage.onchange=function(){var thisLanguage=whichLanguage.options[whichLanguage.options.selectedIndex].value;if(thisLanguage!=""){$("languageForm").submit()}}}var whichUnit=$("unitSelect");if(whichUnit){whichUnit.onchange=function(){var thisUnit=whichUnit.options[whichUnit.options.selectedIndex].value;if(thisUnit!=""){$("unitForm").submit()}}}resizeMap();Event.observe(window,"resize",function(){resizeMap()});if($("renderTime")){renderTime=new Date().getTime();Event.observe(window,"load",function(){$("renderTime").innerHTML="render time: "+(new Date().getTime()-renderTime)+" ms"})}}var console;if(console==undefined){console=new function(){this.log=function(src){}}}function scrollToMap(where){new Effect.ScrollTo("map",{offset:where})}function isMetricSystem(){return isMetric}function isImperialSystem(){return !isMetric}var startList=function(){if(document.all&&document.getElementById){var navRoot=$("meta-nav");if(navRoot){for(i=0;i<navRoot.childNodes.length;i++){node=navRoot.childNodes[i];if(node.nodeName=="LI"){node.onmouseover=function(){this.className+=" over"};node.onmouseout=function(){this.className=this.className.replace(" over","")}}}}}};window.onload=startList;function makeRequest(url,data){var myAjax=new Ajax.Request(url,{method:"post",parameters:data,onComplete:ajax_response})}function ajax_response(originalRequest){var xmldoc=originalRequest.responseXML;var output=xmldoc.getElementsByTagName("response").item(0);var success=output.getAttribute("success");if(success=="true"){output=output.firstChild.data;if($("messageFormField")){$("messageFormField").disabled="disabled"}}else{output=xmldoc.getElementsByTagName("message").item(0);output=output.firstChild.data}$("messageWrapper").style.display="block";output=document.createTextNode(output);$("message").firstChild.data=output.data}function correctAddress(){var fileId=getFormValue($("fileId"));if(fileId){deleteAllChildNodes($("correctTrackLocations"));$("correctTrackLocations").appendChild(Builder.node("img",{src:"images/spinner_bar.gif"}));var callback=function(data){deleteAllChildNodes($("correctTrackLocations"));$("correctTrackLocations").appendChild(Builder.node("img",{src:"images/ok.png"}));window.location.href=serverUrl+"map.do"+addSessionId()+"?fileId="+fileId};Gpsies.correctTrackLocations(fileId,callback)}return false}function recalculateElevation(isRenewElevationData){var fileId=getFormValue($("fileId"));if(fileId){deleteAllChildNodes($("recalculateElevation"));$("recalculateElevation").appendChild(Builder.node("img",{src:"images/spinner_bar.gif"}));var callback=function(data){if(data!=null){deleteAllChildNodes($("recalculateElevation"));$("recalculateElevation").appendChild(document.createTextNode(data))}};Gpsies.requestForRecalculateElevation(fileId,isRenewElevationData,callback)}return false}function getProgressiveElevationData(){var fileId=getFormValue($("fileId"));if(fileId){var callback=function(data){alert(data)};Gpsies.getProgressiveElevationData(fileId,callback)}return false}function reportAsSpam(){var fileId=getFormValue($("fileId"));if(fileId){var note=getFormValue($("inappropriate"));note=stripToEmpty(note);if(note==""&&Prototype.Browser.IE){note=reportAsSpamForm.inappropriate.value;note=stripToEmpty(note)}if(note!=""){var callback=function(data){if(data!=null){deleteAllChildNodes($("reportAsSpam"));$("reportAsSpam").appendChild(document.createTextNode(data))}};Gpsies.reportAsSpam(fileId,note,callback)}else{$("reportAsSpam").className=$("reportAsSpam").className+" error"}}return false}function sendComment(hasAvatar,userId,username,commentId){var fileId=$("fileId");var commentText=$("commentText");if(preventDoubleSubmit()&&commentText&&fileId&&commentText.value.length>0){if($("lastComment")){createProgressbar("lastComment")}if(commentId&&commentId>0){var callback=function(data){window.location.href=serverUrl+"map.do"+addSessionId()+"?fileId="+fileId.value};Gpsies.updateComment(fileId.value,commentText.value,commentId,callback)}else{var callback=function(data){if(data=="OK"&&$("lastComment")){var lastCommentContainer=$("lastComment");deleteAllChildNodes($("lastComment"));if($("commentEdit")){$("commentEdit").style.display="none"}var container=Builder.node("p");if(hasAvatar){var lnk1=Builder.node("a",{href:"avatars/"+userId+"_large.png",rel:"lightbox"});lnk1.appendChild(Builder.node("img",{className:"avatarImage",src:"avatars/"+userId+"_thumb.png",alt:username}));container.appendChild(lnk1);container.appendChild(document.createTextNode(" "))}var span=Builder.node("span",{className:"amenity"});var lnk2=Builder.node("a",{href:"mapThumb.do"+addSessionId()+"?username="+username});lnk2.appendChild(document.createTextNode(username));span.appendChild(lnk2);span.appendChild(document.createTextNode(" "+labelSaid));container.appendChild(span);container.appendChild(Builder.node("br"));lastCommentContainer.appendChild(container);var commentUserContainer=Builder.node("blockquote",{className:"withquote marginLeft"});var commentBlock=Builder.node("p",{className:"withunquote"});commentBlock.appendChild(document.createTextNode($("commentText").value));commentUserContainer.appendChild(commentBlock);lastCommentContainer.appendChild(commentUserContainer);lastCommentContainer.appendChild(Builder.node("br",{className:"clear"}));lastCommentContainer.appendChild(Builder.node("br"))}else{deleteAllChildNodes($("lastComment"))}if($("noComments")){$("noComments").style.display="none"}if($("insertComment")){$("insertComment").style.display="none";$("commentText").value=""}submitCounter=0};Gpsies.insertComment(fileId.value,commentText.value,callback)}}else{submitCounter=0}}function showElement(id){if($(id)){$(id).style.display="block"}}function hideElement(id){if($(id)){$(id).style.display="none"}}function commentEdit(commentId){var commentToEdit=$(commentId);if(commentToEdit){if($("updateComment")){$("commentText").value=commentToEdit.innerHTML;$("submitComment").style.display="none";$("updateComment").style.display="block"}}}function sendPM(){var fileId=$("fileId");var username=$("username");var privateMessage=$("privateMessage");if(preventDoubleSubmit()&&username&&privateMessage&&fileId&&privateMessage.value!=""&&username.value!=""){deleteAllChildNodes($("pm"));var progressbarImg=Builder.node("img",{src:"images/progressbarLarge.gif"});$("pm").appendChild(progressbarImg);var callback=function(data){if(data!=null){var container=Builder.node("p");container.appendChild(document.createTextNode(data));deleteAllChildNodes($("pm"));$("pm").appendChild(container)}else{deleteAllChildNodes($("pm"))}submitCounter=0};Gpsies.sendPrivateMessage(username.value,privateMessage.value,fileId.value,callback)}else{submitCounter=0}return false}function sendRecommendFriend(){var fileId=$("fileId");var recommendFriendTo=$("recommendFriendTo");var recommendFriendMessage=$("recommendFriendMessage");deleteAllChildNodes($("recommendFriendSuccess"));if(preventDoubleSubmit()&&recommendFriendTo&&recommendFriendMessage&&fileId&&fileId.value.length>0&&recommendFriendTo.value.length>0&&recommendFriendMessage.value.length>0){var progressbarImg=Builder.node("img",{src:"images/progressbarLarge.gif"});$("recommendFriendSuccess").appendChild(progressbarImg);var callback=function(data){if(data!=null){var container=Builder.node("p",{className:"hint"});container.appendChild(document.createTextNode(data));deleteAllChildNodes($("recommendFriendSuccess"));$("recommendFriendSuccess").appendChild(container)}else{deleteAllChildNodes($("recommendFriendSuccess"))}submitCounter=0};Gpsies.sendRecommendFriend(recommendFriendTo.value,recommendFriendMessage.value,fileId.value,callback)}else{submitCounter=0}return false}function deleteComment(commentId){if(commentId){var callback=function(data){location.reload()};Gpsies.deleteComment(commentId,callback)}}function rate(ratingType,star){var fileId=getFormValue($("fileId"));if(fileId&&ratingType&&ratingType>0&&ratingType<=5&&star&&star>0&&star<=5){var callBack=function(data){if(data!=null&&typeof data=="object"){if(data.ratingOutput!="nostar"){switch(ratingType){case 1:$("ratingLandscapeOutput").className="rating "+data.ratingOutput;writeInnerHtml("ratingLandscapeCount","("+data.countRatings+")");break;case 2:$("ratingConditionOutput").className="rating "+data.ratingOutput;writeInnerHtml("ratingConditionCount","("+data.countRatings+")");break;case 3:$("ratingFunFactorOutput").className="rating "+data.ratingOutput;writeInnerHtml("ratingFunFactorCount","("+data.countRatings+")");break;case 4:$("ratingDescriptionOfTrackOutput").className="rating "+data.ratingOutput;writeInnerHtml("ratingDescriptionOfTrackCount","("+data.countRatings+")");break;case 5:$("ratingTechniqueOutput").className="rating "+data.ratingOutput;writeInnerHtml("ratingTechniqueCount","("+data.countRatings+")");break}}}};if(fileId){Gpsies.rateTrack(fileId,ratingType,star,callBack)}}return false}function addNotepad(fileId,isLink){if(fileId){var callback=function(data){var id="notepad_"+fileId;var buttonClass=isLink?"button4":"buttonStylish";if(isMobile){buttonClass="btn btn-link"}else{if(isRelaunch){buttonClass="btn btn-default btn-xs"}}var spanContainer=$(id);var linkText=Builder.node("span");linkText.appendChild(document.createTextNode(removeFromNotepad));var removeLink=Builder.node("a",{className:buttonClass,href:"#"});removeLink.onclick=function(){this.blur();return removeNotepad(fileId,isLink)};removeLink.appendChild(linkText);if(isLink){removeLink.appendChild(Builder.node("br"))}deleteAllChildNodes(spanContainer);spanContainer.appendChild(removeLink);if($("notepadSize")){writeInnerHtml($("notepadSize"),data)}};Gpsies.insertUserNotepad(fileId,callback)}return false}function removeNotepad(fileId,isLink){if(fileId){var callback=function(data){var id="notepad_"+fileId;var buttonClass=isLink?"button4":"buttonStylish";if(isMobile){buttonClass="btn btn-link"}else{if(isRelaunch){buttonClass="btn btn-default btn-xs"}}var spanContainer=$(id);var linkText=Builder.node("span");linkText.appendChild(document.createTextNode(addToNotepad));var removeLink=Builder.node("a",{className:buttonClass,href:"#"});removeLink.onclick=function(){this.blur();return addNotepad(fileId,isLink)};removeLink.appendChild(linkText);if(isLink){removeLink.appendChild(Builder.node("br"))}deleteAllChildNodes(spanContainer);spanContainer.appendChild(removeLink);if($("notepadSize")){writeInnerHtml($("notepadSize"),data)}};Gpsies.removeUserNotepad(fileId,callback)}return false}function addFollower(followerUserId,followerUsername){if(followerUserId&&followerUsername){var callback=function(data){var id="follower_"+followerUserId;var buttonClass="btn btn-link";var spanContainer=$(id);var buttonText=replaceAll(removeUserFollower,"null",followerUsername);var linkText=Builder.node("span");linkText.appendChild(document.createTextNode(buttonText));var removeLink=Builder.node("a",{className:buttonClass,href:"#"});removeLink.onclick=function(){this.blur();return removeFollower(followerUserId,followerUsername)};removeLink.appendChild(linkText);deleteAllChildNodes(spanContainer);spanContainer.appendChild(removeLink);if($("followerSize")){writeInnerHtml($("followerSize"),data)}};Gpsies.insertUserFollower(followerUserId,callback)}return false}function removeFollower(followerUserId,followerUsername){if(followerUserId&&followerUsername){var callback=function(data){var id="follower_"+followerUserId;var buttonClass="btn btn-link";var spanContainer=$(id);var buttonText=replaceAll(addUserFollower,"null",followerUsername);var linkText=Builder.node("span");linkText.appendChild(document.createTextNode(buttonText));var removeLink=Builder.node("a",{className:buttonClass,href:"#"});removeLink.onclick=function(){this.blur();return addFollower(followerUserId,followerUsername)};removeLink.appendChild(linkText);deleteAllChildNodes(spanContainer);spanContainer.appendChild(removeLink);if($("followerSize")){writeInnerHtml($("followerSize"),data)}};Gpsies.removeUserFollower(followerUserId,callback)}return false}function resizeMap(justDoIt){var specialSize=justDoIt||isResizeMap||isMapOnly||isMapUserOnly||isCreateTrackOnly||isNotepadListOnly||isWelcomeOnly||isMapFolderOnly||isViewTracksOnly||isFullscreen;var map=$("map");if(map&&!isMapPrint&&!isMobile){var offset=0;for(var elem=$("map");elem!=null;elem=elem.offsetParent){offset+=elem.offsetTop}var windowHeight=getWindowHeight();var bottomHeight=15;if(specialSize){bottomHeight=0}var height=windowHeight-offset-bottomHeight;if(height>=0){var minHeight=600;if(clientName=="falke"){minHeight=200}if(isIframeIntegration){minHeight=iFrameMinHeight;$("map").style.height=minHeight+"px"}else{$("map").style.height=height+"px"}var isIE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6;if(specialSize&&!isIframeIntegration){if(isIE6){$("map").style.height=height+"px"}else{$("map").style.minHeight=height+"px"}}else{if(isIE6){$("map").style.height=minHeight+"px"}else{$("map").style.minHeight=minHeight+"px"}}}}}function getWindowHeight(){if(window.self&&self.innerHeight){return self.innerHeight}if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}return 0}function getWindowWidth(){if(window.self&&self.innerWidth){return self.innerWidth}if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth}return 0}function downloadWaypoint(){var wptLat=parseFloat($("lat").value);var wptLon=parseFloat($("lon").value);if(!isNaN(wptLat)&&!isNaN(wptLon)){$("latWpt").value=wptLat;$("lonWpt").value=wptLon;$("downloadForm").submit()}return false}function downloadWaypoints(){var northWestMarkerLat=parseFloat($("northWestMarkerLat").value);var northWestMarkerLon=parseFloat($("northWestMarkerLon").value);var northEastMarkerLat=parseFloat($("northEastMarkerLat").value);var northEastMarkerLon=parseFloat($("northEastMarkerLon").value);var southWestMarkerLat=parseFloat($("southWestMarkerLat").value);var southWestMarkerLon=parseFloat($("southWestMarkerLon").value);var southEastMarkerLat=parseFloat($("southEastMarkerLat").value);var southEastMarkerLon=parseFloat($("southEastMarkerLon").value);if(!isNaN(northWestMarkerLat)&&!isNaN(northWestMarkerLon)&&!isNaN(northEastMarkerLat)&&!isNaN(northEastMarkerLon)&&!isNaN(southWestMarkerLat)&&!isNaN(southWestMarkerLon)&&!isNaN(southEastMarkerLat)&&!isNaN(southEastMarkerLon)){$("latWpt").value=northWestMarkerLat+"|"+northEastMarkerLat+"|"+southWestMarkerLat+"|"+southEastMarkerLat;$("lonWpt").value=northWestMarkerLon+"|"+northEastMarkerLon+"|"+southWestMarkerLon+"|"+southEastMarkerLon;$("filetype").value="gpxWpt";$("downloadForm").submit()}return false}function replaceAll(txt,replace,with_this){return txt.replace(new RegExp(replace,"g"),with_this)}function escapeQuotes(s){if(s){s=s.replace(/\'/g,"\\'")}return s}function changeCrLf(str){str=replaceAll(str,"\r\n","<br />");str=replaceAll(str,"\r","<br />");str=replaceAll(str,"\n","<br />");return str}function checkCookie(){if($("storeCookie")){var Cookies=new CookieHandler();Cookies.deleteCookie("x")}}function CookieHandler(){this.setCookie=function(name,value,seconds){if(typeof (seconds)!="undefined"){var date=new Date();date.setTime(date.getTime()+(seconds*1000));var expires="; expires="+date.toGMTString()}else{var expires=""}document.cookie=name+"="+value+expires+"; path=/"};this.getCookie=function(name){name=name+"=";var carray=document.cookie.split(";");for(var i=0;i<carray.length;i++){var c=carray[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(name)==0){return c.substring(name.length,c.length)}}return null};this.deleteCookie=function(name){this.setCookie(name,"",-1)}}function toggleEditorHelp(isDisableEditorHelp){var Cookies=new CookieHandler();Cookies.setCookie("y",isDisableEditorHelp+"",60*60*24*365)}function toggleScrollWheelZoom(isScrollWheelZoom){var Cookies=new CookieHandler();Cookies.setCookie("swz",isScrollWheelZoom+"",60*60*24*365)}function openEditor(url){var editorWin=window.open(url,"editor","width=620, height=480");editorWin.focus()}function openPopup(url,width,height){if(!width){width=600}if(!height){height=600}var popup=window.open(url,"popup","width="+width+",height="+height+",resizable=yes,scrollbars=yes,menubar=yes,toolbar=no");popup.focus()}function writeInnerHtml(elemId,elemMsg){if(elemId!=null&&elemId!=""&&$(elemId)&&elemMsg!=null){$(elemId).innerHTML=elemMsg}}function deleteAllChildNodes(parentId){if(parentId){while(parentId.hasChildNodes()){parentId.removeChild(parentId.lastChild)}}}function synchronizeEndpoint(){var startpoint=$("startpoint");var endpoint=$("endpoint");if(startpoint&&endpoint){endpoint.options[startpoint.options.selectedIndex].selected=true}}function stripToEmpty(s){if(s){return s.replace(/^\s+/,"").replace(/\s+$/,"")}else{return""}}function getFormValue(elem){if(elem&&elem.value&&elem.value!=""){return elem.value}return }function defaultString(s1){if(s1!=null){if(s1=="null"||s1=="undefined"){s1=""}else{s1+=""}}else{s1=""}return s1}function toggleOptions(options,button){if($(options)&&$(button)){var isShow=($(options).style.display=="none");if(isShow){if(Prototype.Browser.WebKit){$(options).style.display="block"}else{Effect.Appear($(options))}writeInnerHtml(button,"<span>"+button_hideExtendedOptions+"</span>")}else{if(Prototype.Browser.WebKit){$(options).style.display="none"}else{Effect.Fade($(options))}writeInnerHtml(button,"<span>"+button_showExtendedOptions+"</span>")}}}function toggleSearchLocation(){var isSearchViewportChecked=$("searchViewport").checked;if(isSearchViewportChecked){if(Prototype.Browser.WebKit){$("searchLocation").style.display="none"}else{Effect.Fade($("searchLocation"))}}else{if(Prototype.Browser.WebKit){$("searchLocation").style.display="block"}else{Effect.Appear($("searchLocation"))}}}function toggleTrackTypes(trackTypesGroup){var icon=$(trackTypesGroup+"Img");var iconSym=$(trackTypesGroup+"ImgSym");if(icon&&iconSym&&$(trackTypesGroup)){var src=icon.src;if(src.indexOf("add.png")>-1){icon.src="images/icons/remove.png";iconSym.src="images/icons/bullet_arrow_up.png";Effect.BlindDown($(trackTypesGroup),{duration:0.4})}else{icon.src="images/icons/add.png";iconSym.src="images/icons/bullet_arrow_down.png";Effect.BlindUp($(trackTypesGroup),{duration:0.4})}}}function showLegalsContainer(){Effect.Appear($("legalsContainer"))}function preventDoubleSubmit(frm){var returnVal=false;if(submitCounter==0){submitCounter++;returnVal=true}else{submitCounter++}if(returnVal&&frm&&document.forms[frm]){document.forms[frm].submit()}return returnVal}function insertAfter(newElement,targetElement){var parent=targetElement.parentNode;if(parent.lastchild==targetElement){parent.appendChild(newElement)}else{parent.insertBefore(newElement,targetElement.nextSibling)}}function randomString(){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var string_length=8;var randomstring="";for(var i=0;i<string_length;i++){var rnum=Math.floor(Math.random()*chars.length);randomstring+=chars.substring(rnum,rnum+1)}return randomstring}function getColorNameById(id){if(id){return colorNames[Math.floor(id/(Math.pow(10,0))%10)]}return randomColorName()}function randomColorName(){return colorNames[Math.floor(Math.random()*colorNames.length)]}function randomColor(){return"#"+(Math.random()*16777215<<0).toString(16)}String.prototype.equals=function(sString){return(this==sString)?true:false};var Exception={INVALID_ARGUMENT:"Invalid argument",throwEx:function(eError){if(!(eError instanceof Error)){throw new Error("Invalid Exception Handling")}return"Exception: "+eError.message+" @ "+eError.fileName+":"+(eError.lineNumber-1)}};HashMap=Class.create();HashMap.prototype={oStruct:null,sSize:0,initialize:function(){this.oStruct={};return },clear:function(){this.oStruct={};this.sSize=0;return },containsKey:function(sKey){for(var x in this.oStruct){if(x==sKey&&this.oStruct[sKey]!=undefined){return true}}return false},containsValue:function(sValue){for(var x in this.oStruct){if(this.oStruct[x]!=undefined&&(this.oStruct[x].toString()).equals(sValue.valueOf())){return true}}return false},get:function(sKey){if(!this.containsKey(sKey)){return null}return this.oStruct[sKey]},isEmpty:function(){return(this.sSize<=0)?true:false},put:function(sKey,oObj){if(!(oObj instanceof Object)){throw Exception.throwEx(new Error(Exception.INVALID_ARGUMENT))}oOldObj=null;if(this.containsKey(sKey)){oOldObj=this.get(sKey)}else{this.sSize++}this.oStruct[sKey]=oObj;return oOldObj},remove:function(sKey){if(!this.containsKey(sKey)){return null}oldObj=this.oStruct[sKey];this.oStruct[sKey]=undefined;this.sSize--;return oldObj},size:function(){return this.sSize},toString:function(){var str="[";for(var x in this.oStruct){str+=x+" : "+this.oStruct[x]+","}str+="]";return str}};function getPicasaPhotoEntries(username,albumname,authkey){if(username&&albumname){if(isMapOnly){var callback=function(data){if(data!=null&&typeof data=="object"){var picasaImagesCounter=data.length;var countPhoto="";for(var i=0;i<picasaImagesCounter;i++){if(map){countPhoto=" ["+(i+1)+" / "+picasaImagesCounter+"]";addPhotosToMap(data[i],countPhoto)}}}};Gpsies.getPicasaPhotos(username,albumname,authkey,callback)}else{if($("picasaImages")){var callback=function(data){if(data!=null&&typeof data=="object"){var picasaImages=$("picasaImages");var picasaImagesCounter=data.length;var picasaHtml="<p>";var description="";var countPhoto="";for(var i=0;i<picasaImagesCounter;i++){countPhoto=" ["+(i+1)+" / "+picasaImagesCounter+"]";description=(data[i].description&&data[i].description!=""?data[i].description:data[i].title);picasaHtml+=' <a href="'+data[i].largeUrl+'" rel="lightbox[track]" title="'+data[i].description+'"><img class="mapthumb_img" src="'+data[i].thumbUrl+'" alt="'+data[i].title+'" /></a>';if(map){addPhotosToMap(data[i],countPhoto)}}picasaHtml+="</p>";writeInnerHtml("picasaImages",picasaHtml);initLightbox()}};Gpsies.getPicasaPhotos(username,albumname,authkey,callback)}}}}function openFlashPopup(url){var popupWidth=807;var popupHeight=671;var popupTop=300;var popupLeft=300;var isViewFullScreen=false;var isAutoCenter=true;var popupTarget="popupwin";var popupParams="toolbar=0, scrollbars=0, menubar=0, status=0, resizable=0";if(isViewFullScreen){popupParams+=", fullscreen=1"}else{if(isAutoCenter){popupTop=parseInt((window.screen.height-popupHeight)/2);popupLeft=parseInt((window.screen.width-popupWidth)/2)}}var ua=window.navigator.userAgent;var isOpera=(ua.indexOf("Opera")>-1);var operaVersion;if(isOpera){var i=ua.indexOf("Opera");operaVersion=parseFloat(ua.substring(i+6,ua.indexOf(" ",i+8)));if(operaVersion>7){var isAccessible=false;eval("try { isAccessible = ( (hwndPopup != null) && !hwndPopup.closed ); } catch(exc) { } ");if(!isAccessible){hwndPopup=null}}}if((hwndPopup==null)||hwndPopup.closed){if(isOpera&&(operaVersion<7)){if(url.indexOf("http")!=0){hwndPopup=window.open(url,popupTarget,popupParams+((!isViewFullScreen)?", width="+popupWidth+", height="+popupHeight:""));if(!isViewFullScreen){hwndPopup.moveTo(popupLeft,popupTop)}hwndPopup.focus();return }}if(!(window.navigator.appName=="Netscape"&&!document.getElementById)){popupParams+=", width="+popupWidth+", height="+popupHeight+", left="+popupLeft+", top="+popupTop}else{popupParams+=", left="+popupLeft+", top="+popupTop}hwndPopup=window.open("",popupTarget,popupParams);if(!isViewFullScreen){hwndPopup.resizeTo(popupWidth,popupHeight);hwndPopup.moveTo(popupLeft,popupTop)}hwndPopup.focus();with(hwndPopup.document){open();write("<html><head></head><body onLoad=\"window.location.href='"+url+"'\"></body></html>");close()}}else{if(isOpera&&(operaVersion>7)){eval('try { hwndPopup.focus(); hwndPopup.location.href = url; } catch(exc) { hwndPopup = window.open("'+url+'","'+popupTarget+'","'+popupParams+", width="+popupWidth+", height="+popupHeight+'"); } ')}else{hwndPopup.focus();hwndPopup.location.href=url}}}function showChartMarker(e,maxHeight,chartMarker,chartMarkerType,scaleObj){var trackDist=getDistancePolyline(polyline);var imageWidth=500;var rightSpace=imageWidth-32;var leftSpace=66;if(chartMarkerType&&chartMarkerType=="map"){imageWidth=120;rightSpace=imageWidth-1;leftSpace=3}else{if(isImperialSystem()){maxHeight=maxHeight*3.2808399}if(maxHeight<10){leftSpace=65}else{if(maxHeight<100){leftSpace=53}else{if(maxHeight<1000){leftSpace=57}}}}var offsetX=0;if(window.event){offsetX=window.event.offsetX}else{if(e.layerX){offsetX=e.layerX}else{if(e.offsetX){offsetX=e.offsetX}}}var thisPx=0;var allPx=0;var resultMeter=0;if(scaleObj){rightSpace=scaleObj.scale.scaleContainer.width();leftSpace=22}if(offsetX>leftSpace&&offsetX<rightSpace){thisPx=offsetX-leftSpace;allPx=rightSpace-leftSpace;resultMeter=Math.floor(trackDist/allPx*thisPx);showMarkerByMeter(resultMeter,chartMarker);var chartMarker=$(chartMarker);try{chartMarker.style.display="block";chartMarker.style.left=offsetX+"px"}catch(e){console.log("no chartmarker found")}}}function hideChartMarker1(){_hideChartMarker("chartMarkerMap")}function hideChartMarker2(){_hideChartMarker("chartMarkerBody")}function hideChartMarker(chartMarkerType){if(chartMarkerType){if(chartMarkerType=="chartMarkerMap"){markerTimeout=window.setTimeout(hideChartMarker1,10)}else{if(chartMarkerType=="chartMarkerBody"){markerTimeout=window.setTimeout(hideChartMarker2,10)}}}}function disableHideChartMarker(){window.clearTimeout(markerTimeout)}function getDownload(_country,_trackType){var link=googleEarthAction+"?trackTypes="+_trackType+"&country="+_country;window.open(link+"&mode=external")}function showProgressbar(progressbarElement){if($(progressbarElement)){$(progressbarElement).style.display="block"}}function createProgressbar(progressbarElement){if($(progressbarElement)){var progressbarImg=Builder.node("img",{src:"images/progressbarLarge.gif"});$(progressbarElement).appendChild(progressbarImg)}}function toggleDownloadDropdowns(){if($("sectionTrack")&&$("sectionWaypoints")&&$("sectionTrackWaypoints")){$("convertTypeSelectWaypoint").disabled=true;$("convertTypeSelectTrackWaypoint").disabled=true;$("convertTypeSelectTrack").disabled=true;$("downloadWaypoints").disabled=true;$("downloadTrack").disabled=true;if(waypointsArray&&waypointsArray.length>0&&segmentList&&segmentList.length>1){$("contentboxDownload").style.display="block";$("contentboxFlyoutChart").style.display="block";$("sectionTrackWaypoints").style.display="block";$("sectionWaypoints").style.display="none";$("sectionTrack").style.display="none";if($("dataTypeTrack").checked){$("convertTypeSelectTrack").disabled=false}else{if($("dataTypeWaypoint").checked){$("convertTypeSelectWaypoint").disabled=false}else{if($("dataTypeTrackWaypoint").checked){$("convertTypeSelectTrackWaypoint").disabled=false}else{$("dataTypeTrackWaypoint").checked="checked";$("convertTypeSelectTrackWaypoint").disabled=false}}}}else{if(waypointsArray&&waypointsArray.length>0){$("downloadWaypoints").disabled=false;$("contentboxDownload").style.display="block";$("sectionWaypoints").style.display="block";$("sectionTrackWaypoints").style.display="none";$("sectionTrack").style.display="none"}else{if(segmentList&&segmentList.length>1){$("downloadTrack").disabled=false;$("contentboxDownload").style.display="block";$("contentboxFlyoutChart").style.display="block";$("sectionTrack").style.display="block";$("sectionTrackWaypoints").style.display="none";$("sectionWaypoints").style.display="none"}else{$("contentboxDownload").style.display="none";$("contentboxFlyoutChart").style.display="none"}}}}}function generateFlyoutChartAutomatically(){if(segmentList&&segmentList.length>2){if(segmentList.length!=lastUpdateCounterSegmentList){lastUpdateCounterSegmentList=segmentList.length;generateFlyoutChart()}}}function generateFlyoutChart(){sendCreatedTrackToServer("chart")}function generateFlyoutChartHtml(){var fileId=getFormValue($("fileId"));if(fileId){var callback=function(data){if(data!=null){$("flyoutChart").innerHTML=data}};Gpsies.buildChartHtml(fileId,callback)}return false}function keepAlive(){if(segmentList&&segmentList.length>2){generateFlyoutChart()}else{if(waypointsArray&&waypointsArray.length>0){sendCreatedTrackToServer("keepAlive")}}}function findRoute(latStr,lonStr,link){var query=getRouteQuery(latStr,lonStr,false,true);if(query!=null){link.href=query}}function convertRouteXml(latStr,lonStr,link,filetype){var query=getRouteQuery(latStr,lonStr,true,false);if(query!=null){query=serverUrl+"upload.do"+addSessionId()+"?uploadMode=convert&convertButton=convert&filetype="+filetype+"&formFileUrl="+escape(query);link.href=query}}function getRouteQuery(latStr,lonStr,isXml,isEscape){var query=null;if(latStr&&lonStr){var lat=parseFloat(latStr);var lon=parseFloat(lonStr);if(!isNaN(lat)&&!isNaN(lat)){var daddr=lat+","+lon;var address=getFormValue($("address"));var city=getFormValue($("city"));var saddr="";if(address&&city){if(isEscape){saddr=escape(address)+","}else{saddr=address+","}}if(city){if(isEscape){saddr+=escape(city)+","}else{saddr+=city+","}}if(saddr==""){if(isEscape){saddr=escape($("country").options[$("country").options.selectedIndex].text)}else{saddr=$("country").options[$("country").options.selectedIndex].text}}else{saddr+=$("country").options[$("country").options.selectedIndex].value}if(isXml){query=scheme+"://maps.googleapis.com/maps/api/directions/xml?origin="+saddr+"&destination="+daddr+"&hl="+locale+"&output=xml"}else{query=scheme+"://maps.google.com/maps?saddr="+saddr+"&daddr="+daddr+"&hl="+locale}}}return query}function uploadToOsm(){var fileId=getFormValue($("fileId"));if(fileId){var osmUsername=$("osmUsername");var osmPassword=$("osmPassword");var isHintOSMChecked=$("hintOSMCheckbox")&&$("hintOSMCheckbox").checked;if(!isHintOSMChecked){$("hintOSM").style.color="#EE1B00";$("hintOSM").style.background="#FFE3DF";$("hintOSM").style.fontWeight="bold"}if(isHintOSMChecked&&preventDoubleSubmit()&&fileId&&fileId!=""&&osmUsername&&osmPassword&&((osmUsername.value!=""&&osmPassword.value!="")||(osmUsername.value==""&&osmPassword.value==""))){deleteAllChildNodes($("osmUpload"));if($("osmUpload")){createProgressbar("osmUpload")}var callback=function(data){if(data!=null){deleteAllChildNodes($("osmUpload"));var osmTracesEl=Builder.node("a",{href:"http://www.openstreetmap.org/traces",title:"OpenStreetMap - Traces",target:"osm",className:"button4"});osmTracesEl.appendChild(document.createTextNode(data));$("osmUpload").appendChild(osmTracesEl)}submitCounter=0};Gpsies.sendToOSM(fileId,osmUsername.value,osmPassword.value,callback)}else{submitCounter=0}}}function uploadToTwitter(){var fileId=getFormValue($("fileId"));if(fileId){deleteAllChildNodes($("twitterUpload"));if($("twitterUpload")){createProgressbar("twitterUpload")}var callback=function(data){if(data!=null){deleteAllChildNodes($("twitterUpload"));var twitterId=null;var twitterMessage=null;var sep=data.indexOf("|#|");if(sep>-1){twitterId=data.substring(0,sep);twitterMessage=data.substring(sep+3,data.length)}var twitterEl=Builder.node("p");if(twitterId&&twitterMessage){twitterEl.appendChild(document.createTextNode(twitterMessage));var twitterLinkEl=Builder.node("a",{href:"http://twitter.com/"+twitterId,title:twitterId+" at Twitter",target:"twitter",className:"button3"});twitterLinkEl.appendChild(document.createTextNode("http://twitter.com/"+twitterId));twitterEl.appendChild(twitterLinkEl)}else{twitterEl.appendChild(document.createTextNode(data))}$("twitterUpload").appendChild(twitterEl)}submitCounter=0};Gpsies.sendToTwitter(fileId,callback)}else{submitCounter=0}}var simpleEncoding="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function simpleEncode(valueArray,maxValue,isCountAll){var chartData=[""];var countAllValue=0;var currentValue;for(var i=valueArray.length-1;i>0;i--){currentValue=valueArray[i];if(!isNaN(currentValue)&&currentValue>=0){if(isCountAll){countAllValue+=currentValue;currentValue=countAllValue}chartData.push(simpleEncoding.charAt(Math.round((simpleEncoding.length-1)*currentValue/maxValue)))}else{chartData.push("_")}}return chartData.join("")}function simpleEncodeChart(valueArray,maxValue){var chartData=[""];var countAllValue=0;var currentValue;for(i=0;i<valueArray.length;i++){currentValue=valueArray[i];if(!isNaN(currentValue)&&currentValue>=0){chartData.push(simpleEncoding.charAt(Math.round((simpleEncoding.length-1)*currentValue/maxValue)))}else{chartData.push("_")}}return chartData.join("")}function invertCheckboxes(which){var checkboxes=document.getElementsByName(which);if(checkboxes&&checkboxes.length>0){for(i=0;i<checkboxes.length;i++){checkboxes[i].checked=!checkboxes[i].checked}}}function getCheckboxValuesArray(which){var checkboxesAsArray=null;var checkboxes=document.getElementsByName(which);if(checkboxes&&checkboxes.length>0){checkboxesAsArray=new Array();for(i=0;i<checkboxes.length;i++){if(checkboxes[i].checked){checkboxesAsArray.push(checkboxes[i].value)}}}return checkboxesAsArray}function getTemperatureByUnit(temperature,detectedUnit){var isFahrenheit=isImperialSystem();if(!(isFahrenheit&&detectedUnit=="F")&&!(!isFahrenheit&&detectedUnit=="C")){if(isFahrenheit){temperature=Math.round(temperature*1.8+32)}else{temperature=Math.round((temperature-32)/1.8)}}return temperature+"&deg;"+(isFahrenheit?"F":"C")}function jsonp(url){var body=(document.getElementsByTagName("head")[0]||document.body);if(body){var script=document.createElement("script");script.setAttribute("src",url);script.setAttribute("async",true);script.setAttribute("type","text/javascript");body.appendChild(script);body.removeChild(script)}}function removeWeather(){if($("weatherSection")){deleteAllChildNodes($("weatherSection"));writeInnerHtml("weatherSection",'<br class="clear" />')}else{if($("weatherButton")&&$("weatherAcronym")&&$("weatherAcronym").getAttribute("tip")){$("weatherButton").style.display="none"}}}function jsonpCallbackWeather(data){if(data!=null&&data!=""){var currentWeather=data;if(currentWeather){var weatherMain=currentWeather.main;var weather=currentWeather.weather;if(weather!=null){var weatherHtml='<div title="'+weather[0].description+'">';if(weather[0].icon){var weatherIcon="images/weather/"+weather[0].icon+".png";weatherHtml+='<div style="float: left;" style="margin-right: 5px;"><img src="'+weatherIcon+'" alt="'+weather[0].description+'" /></div>'}var weatherLink="http://openweathermap.org/maps?zoom=11&lat="+currentWeather.coord.lat+"&lon="+currentWeather.coord.lon+"&layers=BFTFFFT";weatherHtml+='<div style="float: left;"><div style="font-size: 1.8em;"><strong>'+(toCelc(weatherMain.temp))+"\u00B0C | "+(toFahrenheit(weatherMain.temp))+"F</strong></div>";weatherHtml+='<div style="display: block; text-align: center;"><a target="_blank" href="'+weatherLink+'">&copy; OpenWeatherMap</a></div></div>';weatherHtml+='<br style="clear: both; line-height: 1px;" />';weatherHtml+="</div>";if($("weatherSection")){if(weatherHtml!=""&&weatherHtml!="undefined"){writeInnerHtml("jsonWeather",weatherHtml)}else{removeWeather()}}else{if($("weatherButton")){if(weatherHtml!=""){if($("weatherAcronym")&&$("weatherAcronym").getAttribute("tip")){weatherButtonHtml=weatherHtml;$("weatherAcronym").setAttribute("tip",weatherButtonHtml)}}else{removeWeather()}}}}else{removeWeather()}}else{removeWeather()}}else{removeWeather()}}function toCelc(t){var p=Math.pow(10,2);return Math.round(((t-273.15)*p)/p)}function toFahrenheit(t){var p=Math.pow(10,2);return Math.round((((t-273.15)*p)/p)*1.8+32)}function getWeather(){weatherUrl=weatherUrl+"&cnt=1&lang="+applicationLanguage+"&callback=jsonpCallbackWeather";jsonp(weatherUrl)}function moveTrackClient(){var fId=getFormValue($("fileId"));if(fId){var callback=function(data){if(data!=null&&data!=""){deleteAllChildNodes($("moveTrackClient"));writeInnerHtml("moveTrackClient",data)}};Gpsies.moveClientTrack(fId,callback)}}function loadFacebookLikebox(){writeInnerHtml("facebookLikebox",'<div style="background-color: #FFFFFF; border-bottom: 1px solid #AAAAAA;"><iframe src="http://www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2FGPSies.Fanpage&amp;width=300&amp;colorscheme=light&amp;show_faces=true&amp;border_color=ffffff&amp;stream=false&amp;header=false&amp;height=180" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:300px; height:160px;" allowTransparency="true"></iframe></div>')}function assignTrackFolder(fId,userFolderSelect){if(fId&&fId!=""&&userFolderSelect){var userFolderId=userFolderSelect.options[userFolderSelect.options.selectedIndex].value;if(userFolderId){var callback=function(data){if(data!=null&&data!="ERROR"){var trackFolderDiv=$("trackFolder_"+fId);if(trackFolderDiv){var parent=trackFolderDiv.parentNode;writeInnerHtml(parent,data)}}};if(isRelaunch){Gpsies.assignTrackFolder(fId,userFolderId,true,"btn-link","form-control",callback)}else{if(isMobile){Gpsies.assignTrackFolder(fId,userFolderId,true,"btn btn-link","form-control",callback)}else{Gpsies.assignTrackFolder(fId,userFolderId,true,"button4","userFolderSelect",callback)}}}}return false}function removeTrackFolder(fId,userFolderId){if(fId&&fId!=""&&userFolderId&&userFolderId!=""){var callback=function(data){if(data!=null&&data!="ERROR"){var trackFolderDiv=$("trackFolder_"+fId);if(trackFolderDiv){var parent=trackFolderDiv.parentNode;writeInnerHtml(parent,data)}}};if(isRelaunch){Gpsies.removeTrackFolder(fId,userFolderId,true,"btn-link","form-control",callback)}else{if(isMobile){Gpsies.removeTrackFolder(fId,userFolderId,true,"btn btn-link","form-control",callback)}else{Gpsies.removeTrackFolder(fId,userFolderId,true,"button4","userFolderSelect",callback)}}}return false}function updateOnlyOwnClientTracks(){var callback=function(data){if(data!=null){refreshMap()}};Gpsies.setOnlyOwnClientTracks(callback)}function updateDisplayTablePageSize(displayTablePageSize){var callback=function(data){if(data!=null){location.reload()}};Gpsies.setDisplayTablePageSize(displayTablePageSize,callback)}function addSessionId(){return";jsessionid="+sessionId}function abbreviateText(text,number){if(text&&text.length>number){return text.substring(0,number)+"..."}return text}function abbreviateText(text,number){if(text&&text.length>number){return text.substring(0,number)+"..."}return text}function getTrackDistanceUnitSystem(td){if(isImperialSystem()){trackDistance=(td*0.621371)}else{trackDistance=td}return trackDistance}function getMarkerNumberInList(fileId){if(listMarkersArray){for(var i=0;i<listMarkersArray.length;i++){if(fileId==listMarkersArray[i]){return(i+1)+""}}}return null}function toggleSection(sectionId){var section=document.getElementById(sectionId);var isSectionOpen=document.getElementById("isSectionOpen");if(section){if(section.style.display=="block"){section.style.display="none";if(isSectionOpen){isSectionOpen.value="false"}}else{if(section.style.display==""||section.style.display=="none"){section.style.display="block";if(isSectionOpen){isSectionOpen.value="true"}}}}}function isWaypoints(){return waypointsArray&&waypointsArray.length>0}function getWaypointNameByType(type){if(waypointTypesArray&&type){for(var i=0,j=waypointTypesArray.length;i<j;++i){if(waypointTypesArray[i].type==type){return waypointTypesArray[i].text}}}return""}function initTrackLength(){if(trackDistance>0){writeInnerHtml("trackLengthId",getDistanceFormated()+(distanceType=="miles"||isImperialSystem()?" miles":" km"))}}function getPaceFormatted(speed){var pace=(1/(speed*10/36))*1000;var timeInSeconds=Math.floor(pace);var hours=Math.floor(timeInSeconds/3600);timeInSeconds=timeInSeconds-(hours*3600);var minutes=Math.floor(timeInSeconds/60);timeInSeconds=timeInSeconds-(minutes*60);var seconds=timeInSeconds;return(minutes+(hours*60))+":"+(seconds<10?"0":"")+seconds}function calculateTrack(input){if($("speed")){var filename;if($("filename")){filename=$("filename").value}var speedValue=$("speed").value;var paceValue=$("pace").value;if($("calculatorForm")){speedValue=document.calculatorForm.speed.value;paceValue=document.calculatorForm.pace.value}if(speedValue==null||speedValue==""||paceValue==null||paceValue==""){speedValue=""+DEFAULT_SPEED;paceValue=""+DEFAULT_PACE}else{speedValue=speedValue.replace(",",".")}if(isNaN(speedValue)){speedValue=""+DEFAULT_SPEED;paceValue=""+DEFAULT_PACE}if(!isNaN(paceValue)){paceValue=parseInt(paceValue)+":00"}if(paceValue.indexOf(":")<0){speedValue=""+DEFAULT_SPEED;paceValue=""+DEFAULT_PACE}var speed=input=="speed"?parseFloat(speedValue.replace(/,/,".")):0;var pace=speed!=0?speed2pace(60/speed):paceValue;if(speed==0){speed=pace2speed(pace)}$("speed").value=Math.round(100*speed)/100;$("pace").value=pace;if($("calculatorForm")){document.calculatorForm.speed.value=$("speed").value;document.calculatorForm.pace.value=pace}var fileId=$("fileId");if((fileId&&fileId.value.indexOf("createTrack")>-1)||filename){TrackEditor.storeTrackValues(speed,filename,function(data){});setTrackStatistics()}else{getDistanceFormElement("distance");setTrackStatisticsShort()}if($("speedOption")){$("speedOption").value=$("speed").value}if($("paceOption")){$("paceOption").value=$("pace").value}}}function speed2pace(i){return((i>=60)?Math.floor(i/60)+":":"")+((i%60<10&&i>=60)?"0":"")+Math.floor(i%60)+":"+(((i*60)%60<10)?"0"+Math.floor((i*60)%60):Math.floor((i*60)%60))}function pace2speed(string){var array=string.split(":");var minuten=(array.length==3)?parseInt(array[0],10)*60+parseInt(array[1],10)+parseInt(array[2],10)/60:parseInt(array[0],10)+parseInt(array[1],10)/60;return(minuten!=0)?(60/minuten):0}function trim(str){return str.replace(/^\s*|\s*$/g,"")}function getDistanceFormElement(styleId){if(styleId&&$(styleId)){var dist=trim($(styleId).innerHTML);if(dist&&dist.length>0){var distArr=dist.split(" ");var distPart=distArr[0].replace(",",".");trackDistance=parseFloat(distPart);if(distArr[1]=="miles"&&isMetricSystem()){trackDistance=trackDistance*0.621371}else{if(distArr[1]=="km"&&isImperialSystem()){trackDistance=trackDistance/0.621371}}trackDistance=trackDistance*1000}}}function getDistanceFormated(){var td=trackDistance;if(isImperialSystem()){td=trackDistance*0.621371}return Math.round(td)/1000}function writeDistance(styleId){var dist=getDistanceFormated()+"";if(locale=="de"){dist=dist.replace(".",",")}writeInnerHtml(styleId," "+dist+" "+distanceType+" ")}function setTrackStatisticsShort(){if($("speed")&&$("trackStatisticsTime")){var speed=$("speed").value;if($("calculatorForm")){speed=document.calculatorForm.speed.value}if(speed!=null){var trDistance=isMetric?trackDistance:trackDistance*0.621371;var secs=Math.round(trDistance/speed*3.6);var hours=(secs-(secs%3600))/3600;secs-=hours*3600;var mins=(secs-(secs%60))/60;secs-=mins*60;writeInnerHtml("trackStatisticsTime",hours+"h "+mins+"m "+secs+"s")}}else{if($("trackStatisticsTime")){writeInnerHtml("trackStatisticsPoints","");writeInnerHtml("trackStatisticsTime","")}}}function debugXml(data){var oSerializer=new XMLSerializer();console.log(oSerializer.serializeToString(data))}function debugObject(data){console.log(DWRUtil.toDescriptiveString(data,2))}function prepareShowCountry(){addHashUrl=true;var trackTypesForm=$("tracksForm");var trackTypes=trackTypesForm?trackTypesForm.trackTypes:null;if(trackTypes){var isChecked=false;for(var i=0;i<trackTypes.length;i++){if(!isChecked){isChecked=trackTypes[i].checked}}if(!isChecked){showHideAllMarkers(true);initGroups()}}var whichCountry=$("countrySelect");if(whichCountry&&whichCountry.options){var thisCountry=whichCountry.options[whichCountry.options.selectedIndex].value;if(thisCountry!=""&&$("citySelection")){showCountry(thisCountry,$("citySelection").value)}}return false}function showHideAllMarkers(isShow){var trackTypes=$("tracksForm").trackTypes;for(var i=0;i<trackTypes.length;i++){trackTypes[i].checked=isShow}}function checkGroupBy(what,isRefreshMapButton){switch(what){case"byFoot":var value=$("trekking")&&$("trekking").checked||$("walking")&&$("walking").checked||$("jogging")&&$("jogging").checked||$("climbing")&&$("climbing").checked;if($("byFoot")){$("byFoot").checked=value}break;case"byBike":var value=$("biking")&&$("biking").checked||$("racingbike")&&$("racingbike").checked||$("mountainbiking")&&$("mountainbiking").checked||$("skating")&&$("skating").checked||$("crossskating")&&$("crossskating").checked||$("handcycle")&&$("handcycle").checked;if($("byBike")){$("byBike").checked=value}break;case"byMotor":var value=$("motocross")&&$("motocross").checked||$("motorbiking")&&$("motorbiking").checked||$("car")&&$("car").checked||$("cabriolet")&&$("cabriolet").checked;if($("byMotor")){$("byMotor").checked=value}break;case"byHorse":var value=$("coach")&&$("coach").checked||$("riding")&&$("riding").checked||$("packAnimalTrekking")&&$("packAnimalTrekking").checked;if($("byHorse")){$("byHorse").checked=value}break;case"byOthers":var value=$("coach")&&$("coach").checked||$("riding")&&$("riding").checked||$("packAnimalTrekking")&&$("packAnimalTrekking").checked||$("climbing")&&$("climbing").checked||$("flying")&&$("flying").checked||$("train")&&$("train").checked||$("sightseeing")&&$("sightseeing").checked||$("geocaching")&&$("geocaching").checked||$("miscellaneous")&&$("miscellaneous").checked;if($("byOthers")){$("byOthers").checked=value}break;case"byWater":var value=$("canoeing")&&$("canoeing").checked||$("swimming")&&$("swimming").checked||$("sailing")&&$("sailing").checked||$("boating")&&$("boating").checked||$("motorboat")&&$("motorboat").checked;if($("byWater")){$("byWater").checked=value}break;case"byWinter":var value=$("wintersports")&&$("wintersports").checked||$("skiingRandonnee")&&$("skiingRandonnee").checked||$("skiingNordic")&&$("skiingNordic").checked||$("snowshoe")&&$("snowshoe").checked||$("skiingAlpine")&&$("skiingAlpine").checked;if($("byWinter")){$("byWinter").checked=value}break}if(isRefreshMapButton){refreshMap()}}function setTrackTypes(what,value){switch(what){case"byFoot":if($("trekking")){$("trekking").checked=value}if($("walking")){$("walking").checked=value}if($("jogging")){$("jogging").checked=value}if($("climbing")){$("climbing").checked=value}break;case"byBike":if($("biking")){$("biking").checked=value}if($("racingbike")){$("racingbike").checked=value}if($("mountainbiking")){$("mountainbiking").checked=value}if($("skating")){$("skating").checked=value}if($("crossskating")){$("crossskating").checked=value}if($("handcycle")){$("handcycle").checked=value}break;case"byMotor":if($("motorbiking")){$("motorbiking").checked=value}if($("motocross")){$("motocross").checked=value}if($("car")){$("car").checked=value}if($("cabriolet")){$("cabriolet").checked=value}break;case"byHorse":if($("riding")){$("riding").checked=value}if($("coach")){$("coach").checked=value}if($("packAnimalTrekking")){$("packAnimalTrekking").checked=value}break;case"byOthers":if($("flying")){$("flying").checked=value}if($("train")){$("train").checked=value}if($("geocaching")){$("geocaching").checked=value}if($("sightseeing")){$("sightseeing").checked=value}if($("miscellaneous")){$("miscellaneous").checked=value}break;case"byWater":if($("swimming")){$("swimming").checked=value}if($("boating")){$("boating").checked=value}if($("canoeing")){$("canoeing").checked=value}if($("sailing")){$("sailing").checked=value}if($("motorboat")){$("motorboat").checked=value}break;case"byWinter":if($("wintersports")){$("wintersports").checked=value}if($("skiingNordic")){$("skiingNordic").checked=value}if($("skiingRandonnee")){$("skiingRandonnee").checked=value}if($("skiingAlpine")){$("skiingAlpine").checked=value}if($("snowshoe")){$("snowshoe").checked=value}break}}function groupBy(what){var value=$(what).checked;switch(what){case"byFoot":if($("trekking")){$("trekking").checked=value}if($("walking")){$("walking").checked=value}if($("jogging")){$("jogging").checked=value}if($("climbing")){$("climbing").checked=value}break;case"byBike":if($("biking")){$("biking").checked=value}if($("racingbike")){$("racingbike").checked=value}if($("mountainbiking")){$("mountainbiking").checked=value}if($("skating")){$("skating").checked=value}if($("crossskating")){$("crossskating").checked=value}if($("handcycle")){$("handcycle").checked=value}break;case"byMotor":if($("motorbiking")){$("motorbiking").checked=value}if($("motocross")){$("motocross").checked=value}if($("car")){$("car").checked=value}if($("cabriolet")){$("cabriolet").checked=value}break;case"byHorse":if($("riding")){$("riding").checked=value}if($("coach")){$("coach").checked=value}if($("packAnimalTrekking")){$("packAnimalTrekking").checked=value}break;case"byOthers":if($("flying")){$("flying").checked=value}if($("train")){$("train").checked=value}if($("geocaching")){$("geocaching").checked=value}if($("sightseeing")){$("sightseeing").checked=value}if($("miscellaneous")){$("miscellaneous").checked=value}break;case"byWater":if($("swimming")){$("swimming").checked=value}if($("boating")){$("boating").checked=value}if($("canoeing")){$("canoeing").checked=value}if($("sailing")){$("sailing").checked=value}if($("motorboat")){$("motorboat").checked=value}break;case"byWinter":if($("wintersports")){$("wintersports").checked=value}if($("skiingNordic")){$("skiingNordic").checked=value}if($("skiingRandonnee")){$("skiingRandonnee").checked=value}if($("skiingAlpine")){$("skiingAlpine").checked=value}if($("snowshoe")){$("snowshoe").checked=value}break}refreshMap()}function initGroups(){if($("byFoot")){$("byFoot").checked=false}if($("byBike")){$("byBike").checked=false}if($("byMotor")){$("byMotor").checked=false}if($("byHorse")){$("byHorse").checked=false}if($("byOthers")){$("byOthers").checked=false}if($("byWater")){$("byWater").checked=false}if($("byWinter")){$("byWinter").checked=false}if($("byFoot")){checkGroupBy("byFoot",false)}if($("byBike")){checkGroupBy("byBike",false)}if($("byMotor")){checkGroupBy("byMotor",false)}if($("byHorse")){checkGroupBy("byHorse",false)}if($("byOthers")){checkGroupBy("byOthers",false)}if($("byWater")){checkGroupBy("byWater",false)}if($("byWinter")){checkGroupBy("byWinter",false)}}function getSelectedTrackTypes(){var selectedTrackTypes="";var trackTypes=$("tracksForm").trackTypes;for(var i=0;i<trackTypes.length;i++){if(trackTypes[i].checked){selectedTrackTypes+="&trackTypes="+trackTypes[i].value}}return selectedTrackTypes}function sleep(t){var startTime=(new Date).getTime();while(startTime+t>(new Date).getTime()){}}function getCountTrackInCountry(){if($("trackCounter")&&$("trackCounter").firstChild.nodeValue.indexOf("(")<0){var country=$("countrySelect");var countryText=country.options[country.options.selectedIndex].text;var text="";if($("trackCounter").hasChildNodes()){text=$("trackCounter").firstChild.nodeValue}text+=countryText;writeInnerHtml("trackCounter",text)}}function getText(key){var text=function(data){if(data!=null&&typeof data=="object"){}};Gpsies.getJavascriptMessage(key,text)}function serializeValues(values){var serializedString="";if(values.value){serializedString=values.value}else{for(var i=0;i<values.length;i++){if(values[i].checked){serializedString+=values[i].value+"|"}}}return serializedString}function searchAddress(){dblclickZoom=false;var address1=$("address1").value;var address2=$("address2").value;var zip=$("zip").value;var city=$("city").value;var startpoint=$("startpoint");var country=startpoint.options[startpoint.options.selectedIndex].value;if(country=="US"){country="United States"}var search="";if(address1.length>0&&address1!=""){search+=address1+","}if(address2.length>0&&address2!=""){search+=address2+","}if(zip.length>0&&zip!=""){search+=zip+" "}if(city.length>0){search+=city+","}search+=country;var callback=function(data){if(data!=null&&typeof data=="object"){$("lat").value=parseFloat(data.lat);$("lon").value=parseFloat(data.lon)}};Gpsies.getGeocoderLatLng(search,callback);return false}function getDownloadUrl(parameters){return gpsiesXml+(parameters!=null?getUrlSign(gpsiesXml)+parameters:"")}function getUrlSign(urlString){var sign="?";if(urlString.indexOf("?")>-1){sign="&"}return sign}function updateDescription(){var descString="";if($("address")&&$("address").value.length>0){descString+=$("address").value+"\r\n"}if($("city")&&$("city").value.length>0){descString+=$("city").value+"\r\n"}if($("country")&&$("country").value.length>0){var countryText=$("country").options[$("country").options.selectedIndex].text;descString+=countryText}if($("description")&&descString.length>0){$("description").value=descString}}function buildViewTracksLink(id,referrer){var downloadForm=$("downloadForm");var count=0;var href=$(id).href;var newHref=href+getUrlSign(href);if(downloadForm){var inputs=document.getElementsByTagName("input");for(var i=0;i<inputs.length;i++){if(inputs[i].type=="checkbox"&&inputs[i].name=="fileId"&&inputs[i].checked){count++;newHref+="fileId="+inputs[i].value+"&";if(count>=DEFAULT_MAX_VIEW_TRACKS){break}}}}if(count>0){if(!referrer||referrer==""){newHref=newHref.substring(0,newHref.length-1)}else{newHref+="referrer="+referrer}$(id).href=newHref}return(count>0)}function getXmlInfoWinTab(node){var childNodes=node.childNodes;var infoTabs;for(var k=0;k<childNodes.length;k++){if(childNodes[k].nodeType==1){if(childNodes[k].nodeName=="i"){infoTabs=getTabText(childNodes[k])}}}return infoTabs}function validateFileIds(){var downloadForm=$("downloadForm");var count=0;if(downloadForm&&downloadForm.fileId){var inputs=document.getElementsByTagName("input");for(var i=0;i<inputs.length;i++){if(inputs[i].type=="checkbox"&&inputs[i].name=="fileId"&&inputs[i].checked){count++}}}if(count>0){downloadForm.submit()}}function round(val,prec){return parseFloat(parseFloat(val).toFixed(prec))}function roundFull(x,n){if(n<1||n>14){return false}var e=Math.pow(10,n);var k=(Math.round(x*e)/e).toString();if(k.indexOf(".")==-1){k+="."}k+=e.toString().substring(1);return k.substring(0,k.indexOf(".")+n+1)}function getRealDistanceKm(fileId){if(fileId){var callback=function(data){if(data!=null){var len=parseFloat(data);if(len>0&&$("realDistanceKm")){var dist=len-getTrackDistanceUnitSystem(trackDistance/1000);if(dist>=0){len=round(len,3);dist=round(dist,3);var distMeter=round(dist*1000);if(isImperialSystem()){distMeter=round(distMeter*3.2808399)}$("realDistanceKm").appendChild(document.createTextNode(len+(isImperialSystem()?" "+showMiles:" "+showKilometer)+" (+ "+(distMeter)+(isImperialSystem()?" ft":" m")+")"))}}$("realDistanceKmButton").href="javascript:void(0)"}};Gpsies.calculateRealDistanceKm(fileId,callback)}return false}function getCheckedRadioValue(name){var elements=document.getElementsByName(name);if(elements){for(var i=0,len=elements.length;i<len;++i){if(elements[i].checked){return elements[i].value}}}}function uncheckRadio(name){var elements=document.getElementsByName(name);if(elements){for(var i=0,len=elements.length;i<len;++i){elements[i].checked=false}}}function confirmDeleteTracks(text){var downloadForm=$("downloadForm");var deleteMultipleTracks=$("deleteMultipleTracks");var count=0;if(downloadForm){var inputs=document.getElementsByTagName("input");for(var i=0;i<inputs.length;i++){if(inputs[i].type=="checkbox"&&inputs[i].name=="fileId"&&inputs[i].checked){count++}}}if(count>0){var deleteMultipleTracksConfirm=confirm(text);if(deleteMultipleTracksConfirm){deleteMultipleTracks.value="true";downloadForm.submit()}}return false}function isNumber(n){return !isNaN(parseFloat(n))&&isFinite(n)}function getRequestParameter(name,url){var value=decodeURIComponent((RegExp(name+"=(.+?)(&|$)").exec(url)||[,""])[1]);return(value!=="null")?value:false}function getRequestParameter2(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results==null){return""}else{return results[1]}}function cloneByJson(obj){return JSON.parse(JSON.stringify(obj))}function siteSearchResult(response){var href=window.location.href;var serverAndContext=href.substr(0,href.indexOf(href.split("/").pop()));if($("siteSearchContent")&&response){var item;var innerHtml="<dl>";for(var i=0;i<response.items.length;i++){item=response.items[i];innerHtml+='<dt><a href="'+item.link+'">'+item.htmlTitle+"</a></dt><dd>"+item.htmlSnippet+"<br /><br /></dd>"}innerHtml+="</dl>";innerHtml=replaceAll(innerHtml,"http://www.gpsies.com/",serverAndContext);writeInnerHtml("siteSearchContent",innerHtml)}}function getSiteSearchResults(){if($("siteSeachQuery")&&$("siteSeachQuery").value!=""){var siteSearchApiUrl="https://www.googleapis.com/customsearch/v1?key=AIzaSyCMGfdDaSfjqv5zYoS0mTJnOT3e9MURWkU&cx=005618558772676650468:_ucdwnhlq_8&q="+$("siteSeachQuery").value+" -download.do -xml&callback=siteSearchResult";jsonp(siteSearchApiUrl)}else{document.getElementById("siteSearchContent").innerHTML+="no results..."}}function redirectMobileSite(url){window.setTimeout("window.location.replace('"+url+"')",100)}function convertDateToUTC(date){return new Date(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds())}function convertUTCToLocalDate(date){var newDate=new Date(date.getTime()+date.getTimezoneOffset()*60*1000);var offset=date.getTimezoneOffset()/60;var hours=date.getHours();newDate.setHours(hours-offset);return newDate}function convertUTCToLocalTime(d){var timeOffset=-((new Date()).getTimezoneOffset()/60);d.setHours(d.getHours()+timeOffset);return d}function convertUTCToLocalTime2(d){return new Date(d.toString().replace(/UTC.*/g,"")+d.getYear())}function checkUserAvatar(userId,status){if(userId){var callback=function(data){console.log(data)};Gpsies.updateAvatarCheck(userId,status,callback)}}function updateUserLiveTrackingStatus(username){if(username&&$("allowPublicLiveTracking")){var callback=function(data){if(data=="OK"){location.reload()}};Gpsies.updateUserLiveTrackingStatus(username,$("allowPublicLiveTracking").checked,callback)}}function isSafari(){return/^((?!chrome).)*safari/i.test(navigator.userAgent)};